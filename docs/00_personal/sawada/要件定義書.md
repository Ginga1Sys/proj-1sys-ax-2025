# 要件定義書

- 作成者: 澤田拓樹
- 作成日: 2025-11-28
 - バージョン: 1.0 (暫定、承認待ち)

---

## 1. 文書の目的
本書は、社内向けナレッジ共有プラットフォーム（以下「本システム」）の要件を整理し、開発・受入・運用の共通認識を作ることを目的とする。

参照ドキュメント:
- `ユーザーストーリー_顧客要求事項.md`
- `機能要件.md`
- `非機能要件.md`
- `要件定義書のために必要なその他の情報.md`（補完済み）

## 2. 背景と概要
社内（想定ユーザー: 約600名）で利用するナレッジ共有プラットフォームを構築する。社員が投稿・検索・議論できる場を提供し、業務知見やAI活用ノウハウの蓄積を目的とする。

## 3. スコープ
- 含める機能:
  - ユーザー認証（社内ドメイン制限、メール認証）
  - 投稿作成・編集（テキスト、画像、リンク、ファイル添付）
  - 投稿承認ワークフロー（管理者承認）
  - 検索・フィルタ（キーワード、タグ、投稿者、ソート）
  - インタラクション（いいね、コメント、通報）
  - 権限管理（Admin / Editor / User 等）
- 除外（今回スコープ外、将来検討）:
  - 管理者向けの高度なダッシュボード
  - 多言語対応のフル対応
  - モバイル向けフル最適化

（本ドキュメントでは `要件定義書のために必要なその他の情報.md` に記載された補完値を最終値として確定しています）

## 4. ステークホルダー（確定値）
- 発注者: AI活用推進部長（仮） — 要件決定、予算承認
- PO: 社内AI担当プロダクトオーナー（仮） — 優先度決定、受け入れ判断
- 開発責任者: 開発チームリード（仮） — 技術的意思決定
- 運用担当: システム運用チーム（仮） — デプロイ・監視・障害対応
- セキュリティ責任者: 情報セキュリティ室（仮） — セキュリティ要件の承認
- サイト管理者: コンテンツ承認/ユーザー管理を行う管理者（仮）

（本プロジェクトは擬似プロジェクトの前提であるため、上記の「（仮）」表記も本ドキュメント内では最終担当として確定扱いとします）

## 5. 主要業務フロー（概要、補完済み）
- ユーザー登録／ログイン: 社内メールで登録、メール認証、ログイン、プロフィール編集
- 投稿作成／編集／公開: 下書き→公開リクエスト→管理者承認→公開
- 投稿承認: 管理者が承認/却下、履歴保存
- 投稿への反応: 認証ユーザーがいいね・コメント（返信含む）
- 検索/フィルタ: キーワード横断検索、タグやカテゴリーで絞り込み

※ 業務フロー詳細は画面・API設計時にワイヤー/フロー図として確定する。

## 6. 機能要件
（`機能要件.md` に基づく、識別子は暫定）

- FR-001: ユーザー認証
  - 社内ドメインのメールで登録/ログイン
  - メール確認または管理者承認を含む登録フロー
  - パスワードリセット機能
  - 認証情報は安全に保管（bcrypt 等）

- FR-002: 投稿（作成・編集）
  - テキスト／画像／リンク／ファイル添付をサポート
  - タグ付け・カテゴリ選択
  - 編集履歴の保存と参照
  - ドラフト保存（オプション）

- FR-003: 投稿承認ワークフロー
  - 管理者による承認/却下
  - 承認・却下の履歴記録

- FR-004: 検索とフィルタ
  - タイトル・本文・タグ・投稿者名で検索
  - タグによる絞り込み
  - 検索結果のソート（関連度/日付）

- FR-005: インタラクション（いいね・コメント）
  - いいねの集計
  - コメント、返信スレッド
  - 不適切なコメントを通報する仕組み

- FR-006: 権限管理
  - Admin/Editor/User/Viewer 等のロールでアクセス制御
  - 機密情報はロールに応じて制御

## 7. 非機能要件（確定値）
- NFR-001: セキュリティ
  - 全通信は TLS（HTTPS）
  - パスワードは bcrypt 等でハッシュ化
  - 添付ファイルのウイルスチェックを検討・導入
  - 重要操作の監査ログを保存・保護
  - 定期的な脆弱性スキャンを実施する

- NFR-002: パフォーマンス・可用性
  - 目標（整合済）: 平均応答時間 1.5秒以内、p95 <= 2秒、p99 <= 3秒
  - 同時アクセス想定: ピーク同時リクエスト 100件程度（負荷試験で確認）
  - 備考: 平均とパーセンタイルの目標を整合させ、負荷試験シナリオで確認すること
  - 稼働率目標: 99.9%

- NFR-003: 拡張性
  - モジュール化された設計、API/データモデルの拡張性を確保する

- NFR-004: 運用・保守
  - DB 日次バックアップ、RTO 4時間、RPO 24時間
  - ログ保持期間: 90日（監査ログは別途検討）

## 8. データ要件（暫定）
- 主要エンティティと属性（暫定）:
  - ユーザー: id(UUID), 名前, メール(社内ドメイン), ロール, 作成日時, 更新日時
  - 投稿: id(UUID), タイトル(≤255), 本文, タグ[], 添付ファイル参照[], ステータス(enum), 作成者ID, 作成日時, 更新履歴
  - コメント: id, 投稿ID, 作成者ID, 本文, 親コメントID, 作成日時
  - イイね: id, 投稿ID, ユーザーID, 作成日時
  - タグ: id, 名称, 作成日時
  - 監査ログ: 操作種別, 対象, 実行者, タイムスタンプ

（フィールドの型・制約はデータ設計工程で詳細化）

## 9. 外部連携・依存
- メール送信: SMTP または社内メールAPI（TLS） — メール認証、パスワードリセット
- ファイルストレージ: S3互換ストレージ（本番想定） — 添付ファイル保存
- 将来的連携: LDAP/AD/SSO（SAML/OAuth2）を想定

## 10. 認証・認可の詳細（補完済み）
- 認証: 現状はメール/パスワード認証（社内ドメイン制限、メール確認）
- 将来的に SSO（SAML/OAuth2）へ移行可能な設計を推奨
- ロール一覧: Admin, Editor, User, Viewer, Guest(未認証: 制限あり)
- セッション有効期限: 8時間（暫定）
- MFA: 保留（セキュリティ方針により導入検討）

## 11. テスト・受け入れ基準
- 受け入れテストは主要ユーザーストーリー（認証、投稿、検索、承認、インタラクション）をカバーすること
- 受入基準は可能な限り具体的に定義し、Given/When/Then 形式で記述する。代表的な例を以下に示す。

- 受入基準例（認証）:
  - Given: 社内ドメインのメールで登録済みのユーザーが正しい資格情報でログインする
  - When: ログイン処理を行う
  - Then: ステータス200で認証トークンが発行され、セッションが作成される。ログイン失敗率は0.5%未満。

- 受入基準例（投稿承認フロー）:
  - Given: 認証済ユーザーが投稿を作成し「公開リクエスト」を送る
  - When: 管理者が承認操作を行う
  - Then: 投稿は公開状態になり、公開後すぐに他ユーザーから閲覧可能である。承認操作の応答は3分以内。

- 受入基準例（検索）:
  - Given: 存在する投稿に対してキーワード検索を行う
  - When: 検索を実行する
  - Then: 検索結果に該当投稿が上位に表示される（関連度上位10件に含まれること）。検索応答時間はp95 <= 2秒。

- 負荷試験: ピーク同時リクエスト100件で主要機能に致命的な性能低下がないことを確認する（目標に一致すること）。

- 受入判定: 主要ケースの全てがパスし、定義した性能・エラーレート閾値を満たしていること。

## 12. 運用・監視・バックアップ
- 監視対象（推奨）: レスポンス時間(p95/p99)、エラーレート(5xx)、CPU/メモリ、ディスク容量、DB接続数
- アラート閾値（暫定）: HTTP5xx率>1%、p95>2sで警告、p95>3sで重大アラート
- 通知先: 開発/運用チームの専用 Slack チャンネル、重大障害はメールも併用
- バックアップ: DB 日次スナップショット、ファイルはオブジェクトストレージでバージョニング

## 13. データ移行
- 既存データ移行は想定しない（本要件では新規構築とする）
- 既存ドキュメントを移行する必要が生じた場合は、CSV/Markdown からのインポートスクリプトを別途作成する


## 14. 既知の制約・リスク（確定値）
- 本プロジェクトは擬似プロジェクトである前提のまま進める
- 認証方式: 初期はメール/パスワード（社内ドメイン制限）で実装し、将来的に SSO（SAML/OAuth2）へ移行する
- 添付ファイルのウイルス対策や機密情報取り扱いは、セキュリティ責任者の基準に従い実装する
- コンテンツ不足リスク: ローンチ時の運用・周知計画を立てることで緩和する

## 15. スケジュール案
- MVP リリース目安: プロジェクト開始から 3 ヶ月（本ドキュメントでは確定値として扱う。正式見積りにより微調整可）

## 16. 次のアクション
1. 本書を基に画面仕様、API 仕様、データ設計を作成する
2. 見積り・スプリント計画を策定する
3. 実装→テスト→受け入れのサイクルを回す

---

作成元: `ユーザーストーリー_顧客要求事項.md`, `機能要件.md`, `非機能要件.md`, `要件定義書のために必要なその他の情報.md`
