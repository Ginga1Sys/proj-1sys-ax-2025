---
title: 要件定義書（統合案）
author: 澤田拓樹 / ドキュメント統合チーム
date: 2025-11-28
revision: 1.0-draft
---

# 要件定義書（統合案）

**目的**
- 社内向けナレッジ共有プラットフォーム（以下「本システム」）の要件を確定し、開発・受入・運用に必要な仕様を実行可能な形で提示する。

**参照元**
- `要件定義書_01.md`, `要件定義書_02.md`, `要件定義書_03.md`, `要件定義書_04.md`
- `ユーザーストーリー_顧客要求事項.md`, `機能要件.md`, `非機能要件.md`, `要件定義書のために必要なその他の情報.md`

## 1. 文書の適用範囲と前提
- 対象: 社内ユーザー向け投稿・検索・閲覧・インタラクション・承認ワークフロー・権限管理
- 想定ユーザー数: 約600名（初期）、ピーク同時接続100セッション想定
- インフラ: クラウド想定（AWS/GCP/Azure）だがオンプレ運用可能な設計
- 社内メールドメインのプレースホルダ: `@yourcompany.co.jp`（導入時に実値へ置換）

## 2. ステークホルダー
- 発注者、PO、開発責任者、運用担当、セキュリティ責任者、サイト管理者（詳細は別紙/プロジェクト定義に記載）

## 3. サマリ（ユーザーストーリー要約）
- 社内ドメインでの登録/ログイン（メール確認・管理者承認オプション）
- 投稿作成・編集（テキスト/画像/リンク/添付、タグ、編集履歴、ドラフト）
- 投稿承認ワークフロー（下書き→公開申請→管理者承認）
- 検索（フルテキスト／タグ／投稿者／ソート）
- いいね・コメント（スレッド）・通報
- ロールベースの権限管理（Admin/Editor/User/Viewer 等）

## 4. 機能要件（FR）
- FR-001: ユーザー認証（優先度: 高）
  - 社内ドメインのメールアドレスのみで登録可能（ドメイン検証）。
  - メール確認リンクでアカウント有効化。管理者承認フローは管理画面で切替可能。
  - パスワードは `bcrypt` でハッシュ化（コストファクタ: 12 を推奨）。
  - パスワードリセットはメールベース。認証APIはTLS1.2以上で保護。

  - 受け入れ基準:
    - 新規登録は社内ドメインのメールアドレスのみ受け付け、確認メールからアクティベーションできること（関連TC: TC-AUTH-01）。
    - 社外ドメインでの登録試行は拒否され、明確なエラーメッセージが返ること（関連TC: TC-AUTH-02）。
    - パスワードはサーバ側でbcryptでハッシュ化されて保存されること（単体テストでwork factor >= 12 を検証）。
    - 認証に使用するエンドポイントは TLS 1.2 以上で保護されていること（統合テストで確認）。

- FR-002: 投稿作成・編集（優先度: 高）
  - リッチテキスト（MarkdownまたはWYSIWYG）をサポート。
  - 画像は最大 10MB、添付ファイルは最大 50MB（初期値、運用で調整可）。
  - タグ管理（作成・選択・ブラックリストは管理者が設定可能）。
  - 編集履歴（バージョン）保持、ドラフト保存（自動保存＋明示的保存）。

  - 受け入れ基準:
    - タイトル・本文・添付ファイルを含む投稿が作成できること（関連TC: TC-POST-01）。
    - 添付ファイルはサポートするファイル形式（例: png,jpg,pdf）とサイズ上限（デフォルト: 画像10MB, 添付50MB）を超える場合に拒否されること。
    - 自動保存（autosave）が指定間隔で動作し、編集中にブラウザを閉じてもドラフトが復元可能であること。
    - 投稿編集での変更はリビジョンとして履歴に残り、履歴から復元できること（関連TC: TC-POST-02）。
    - 添付ファイルはアップロード時にウイルススキャンを通過しない場合は保存されず、適切なエラーメッセージが表示されること。

- FR-003: 投稿承認ワークフロー（優先度: 中）
  - ステータス管理: `draft` / `pending` / `published` 等。承認/却下の履歴とコメントを保存。

  - 受け入れ基準:
    - ステータス遷移（draft→pending→published/declined）が正しく適用され、遷移の履歴とコメントが保存されていること。
    - 承認者は承認/却下を行えること、各操作は監査ログに記録されること。
    - 公開申請時に管理者へ通知が送信されること（通知方法は要仕様）。

- FR-004: 検索・フィルタ（優先度: 高）
  - フルテキスト検索（タイトル・本文・タグ・コメント）。初期は Elasticsearch 等を想定。
  - ソート: 関連度／日付、絞り込み: タグ／投稿者／日付範囲。

  - 受け入れ基準:
    - フルテキスト検索でタイトル・本文・タグ・コメントを対象に検索が行われ、想定される関連結果が返ること（サンプルデータでの受入テスト）。
    - タグ／投稿者／日付範囲による絞り込みが機能すること。
    - ソート（関連度/日付）が期待どおりに動作すること。

- FR-005: インタラクション（優先度: 高）
  - いいね（ユーザー毎1回）、コメント（スレッド、返信）、通報機能。
  - モデレーション（管理者による削除・非表示）と通報履歴の保存。

  - 受け入れ基準:
    - ユーザーは投稿に対して1回だけ「いいね」ができ、二重登録を防止できること。
    - コメントはスレッド化され、返信がネストされて表示されること。
    - 通報が行われると通報レコードが保存され、管理者が確認できること。
    - 管理者による削除/非表示操作はコンテンツの表示に即時反映され、操作履歴が監査ログに残ること。

- FR-006: 権限管理（優先度: 中）
  - ロールは管理画面で割当・変更可能。ロールに応じたアクセス制御を実装。

  - 受け入れ基準:
    - ロール毎のアクセス制御が期待どおりに機能し、権限のない操作は拒否されること。
    - 管理画面でのロール割当/変更は即時反映され、該当ユーザーのアクセス権が更新されること。
    - 重要な権限変更は監査ログに記録され、関連するテストで確認できること。

## 5. 非機能要件（NFR）
- NFR-001: セキュリティ（優先度: 高）
  - 全通信は TLS 1.2 以上、TLS 1.3 を推奨。
  - パスワードは `bcrypt`（work factor=12 推奨）。
  - 重要操作（ユーザー作成/権限変更/コンテンツ削除）は監査ログに記録。
  - 監査ログ保持期間: **365日**（セキュリティ要件より長期間を採用）。
  - 添付ファイルはウイルススキャンを実施し、保存は AES-256 を推奨。
  - OWASP Top10 に準拠した対策（入力検証、CSRF、XSS対策、CSP 等）。

- NFR-002: パフォーマンス・可用性（優先度: 中）
  - 読み取り API: p95 < 1.5s を目標。
  - 書き込み API: p95 < 2.5s を目標。
  - p99 応答時間: <= 3s（重要ケースでの目安）。
  - ピーク同時アクセス: 100 セッション想定。
  - 可用性目標（初期）: 99.5%〜99.9%（要ステークホルダー確定）。

- NFR-003: 拡張性
  - APIファースト設計、モジュール化、将来のSSO/LDAP連携を容易にする設計。

- NFR-004: 運用・保守
  - DB 日次バックアップ、バックアップ保持期間: **30日**（初期）。
  - 監視: p95/p99 応答時間、HTTP5xx率、CPU/メモリ、DB接続数等。
  - ログ保持: アクセスログ 90日（運用ログ）、監査ログは365日。
  - RTO: 4時間、RPO: 24時間（暫定、`要確認`）。

## 6. データ要件（暫定）
- 主なエンティティと例フィールド:
  - User: id(UUID), name, email(社内ドメイン), role, created_at, updated_at
  - Post: id(UUID), title(<=255), body, tags[], attachments[], status(enum), author_id, created_at, updated_at, revisions[]
  - Comment: id, post_id, author_id, body, parent_comment_id, created_at
  - Like: id, post_id, user_id, created_at
  - Tag: id, name, created_at
  - AuditLog: actor_id, action, target_id, timestamp, metadata

## 7. API設計（例）
- 認証: `POST /api/v1/auth/register`, `POST /api/v1/auth/login`, `POST /api/v1/auth/reset`
- 投稿: `GET /api/v1/posts`, `POST /api/v1/posts`, `PUT /api/v1/posts/{id}`, `DELETE /api/v1/posts/{id}`
- 検索: `GET /api/v1/search?q={query}&tag={tag}&sort={relevance|date}`

（詳細な API 仕様は別途 API 仕様書で定義）

## 8. 受け入れ基準とテスト（抜粋）
- 認証
  - TC-AUTH-01: 社内ドメインのメールアドレスで新規登録→確認メール受信→アクティベーション成功
  - TC-AUTH-02: 不正ドメインの登録は拒否され、適切なエラーメッセージを返す
- 投稿
  - TC-POST-01: タイトル/本文/添付を含む投稿が作成され、`draft`または`pending`ステータスが適用される
  - TC-POST-02: 下書き編集で編集履歴が保存される
- 検索
  - TC-SEARCH-01: キーワード検索で該当投稿が上位に表示され、検索 API の p95 <= 2s（テスト条件明示）
- パフォーマンス/負荷
  - 負荷試験: ピーク同時リクエスト100件で主要指標（p95/p99/エラーレート）を確認

## 9. 運用・監視・バックアップ
- 監視対象: レスポンス時間(p95/p99)、エラーレート(5xx)、CPU/メモリ、ディスク容量、DB接続数
- アラート閾値（暫定）: HTTP5xx率>1% 警告、p95>2s 警告、p95>3s 重大アラート
- バックアップ: 日次スナップショット、保持 30 日
- 監査ログ: 365 日保持、検索・エクスポート用の仕組みを検討

## 10. 外部連携・依存
- メール送信: SMTP または社内メールAPI（TLS）
- ファイルストレージ: S3 互換オブジェクトストレージ推奨
- 将来的連携: LDAP/AD/SSO（SAML/OAuth2）を想定

## 11. 未確定事項（要ワークショップ）
- 正式な SLA（99.5% vs 99.9% の決定）
- RTO/RPO の最終確定（暫定 RTO 4h / RPO 24h）
- MFA の導入可否、セッション自動ログアウト方針（現行: セッション有効期限 8h）
- 監査ログの保持方針（運用・法務との調整）

## 12. リスクと対策（抜粋）
- 検索性能リスク: 早期に検索エンジン導入を検討（Elasticsearch 等）
- コンテンツ不足: ローンチ時の運用周知＋コンテンツ投入計画を策定
- 管理者運用ボトルネック: 自動承認ルールや権限委譲の検討

## 13. 次のアクション（推奨）
1. 本統合案のレビューとステークホルダー承認ワークショップを実施する
2. API 仕様書・データ設計書を作成する
3. 見積り（工数・コスト）とスプリント計画を作成する
4. プロトタイプ（MVP）を早期に実装してユーザーテストを実施する

---

注: 本統合案は `要件定義書_04.md` を骨子とし、`要件定義書_02.md` の具体値（`bcrypt cost=12`, ファイルサイズ上限等）および `要件定義書_03.md` の運用・性能値（RTO/RPO、p95/p99 目標等）を採用・整合したものです。矛盾する箇所は「より測定可能／実務に即した値」を優先して採用しています。
