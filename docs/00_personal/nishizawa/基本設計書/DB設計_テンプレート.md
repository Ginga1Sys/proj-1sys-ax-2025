# DB設計（基本設計書）テンプレート

## 1. ドキュメント情報
- ドキュメント名：DB設計（基本設計書）
- バージョン：
- 作成日：
- 作成者：
- 対応システム：AI活用ナレッジ共有サイト
- 対象フェーズ：基本設計

## 2. 目的
- 本書の目的（設計範囲、成果物、利用者）

## 3. 適用範囲・前提条件
- 対象データ、対象サブシステム、前提（RDBMS種類、バージョン、文字コード、OS）

## 4. 用語定義
- プロジェクトで使用する主要用語の定義

## 5. 非機能要件（DB観点）
- 性能（RPS、同時接続数、レスポンスタイム目標）
- 容量（初期データ量、成長率、保存期間）
- 可用性、バックアップ頻度、リストア目標（RTO/RPO）
- セキュリティ要件（暗号化、アクセス制御、監査ログ）

## 6. 概要設計（論理設計）
- エンティティ一覧（主要テーブル名と概要）
- ER図（論理ER）※ファイル添付または参照
- 相互関係の説明（1:N、N:N、1:1）

## 7. テーブル設計（物理設計）テンプレート
- テーブル名：
- 説明：
- 備考（参照元仕様、サブシステム）

テーブル単位で以下を記載（表形式）

| No | カラム名 | 型 | 長さ/小数 | NULL許可 | PK/FK | 初期値/デフォルト | 制約/チェック | インデックス | 説明 |
|---:|---|---:|---:|---:|---:|---:|---:|---:|---|
| 1 | id | BIGINT | - | NO | PK, 自動採番 | - | - | PK | 主キー |
| 2 | user_id | BIGINT | - | NO | FK -> users.id | - | - | 有り | ユーザー参照 |
| 3 | title | VARCHAR | 255 | NO | - | '' | length>0 | 有り(全文/部分) | 記事タイトル |
| ... | ... | ... | ... | ... | ... | ... | ... | ... | ... |

- インデックス設計（カーディナリティ、複合インデックス、ユニーク制約）
- パーティショニング方針（必要な場合）
- 参照整合性（外部キー制約、ON DELETE/ON UPDATEルール）
- NULL/デフォルト方針

## 8. シーケンス・自動採番
- シーケンス名、開始値、増分、管理方針

## 9. 物理チューニング方針
- テーブル分割、インデックス運用、集計テーブル、キャッシュ方針

## 10. バックアップ・リカバリ設計
- バックアップ方式（フル/差分/増分）、頻度、保存先、保持期間
- リストア手順（簡潔）

## 11. データ移行・初期投入設計
- 初期データ一覧、移行手順、整合性チェック項目

## 12. セキュリティ設計
- 接続制御（DBユーザー、権限分離）
- 暗号化（静止データ、通信）
- ログ監査（監査項目、保持期間）

## 13. 運用監視設計
- 監視項目（接続数、遅延、ディスク使用率）
- アラート基準、対応フロー

## 14. テスト観点
- 単体/結合/性能テストでのDB検証項目（トランザクション整合性、障害復旧）

## 15. 命名規則
- テーブル、カラム、インデックス、制約、シーケンスの命名規則（例: tbl_*, idx_*, fk_*）

## 16. サンプルDDL（例）
```sql
CREATE TABLE article (
  id BIGINT PRIMARY KEY IDENTITY(1,1),
  user_id BIGINT NOT NULL,
  title VARCHAR(255) NOT NULL,
  body TEXT NULL,
  status VARCHAR(20) NOT NULL DEFAULT 'draft',
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT fk_article_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
CREATE INDEX idx_article_user_created ON article(user_id, created_at);
```

## 17. 付録
- ER図ファイル、参考資料、変更履歴、決定済み設計のトレードオフ